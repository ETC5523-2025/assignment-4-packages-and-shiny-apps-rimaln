## code to prepare `DATASET` dataset goes here

library(readr)
library(dplyr)
library(janitor)
library(stringr)

# Load your NEON nitrate data (choose the appropriate file)
raw <- read_csv("data-raw/NEON.D13.COMO.DP1.20033.001.102.100.015.NSW_15_minute.2020-06.basic.20200704T015842Z.csv")

# View the names to check correct spelling before cleaning
print(names(raw))

# Clean: remove rows missing nitrate mean or datetimes, clean names
neon_nitrate <- raw  |>
  filter(!is.na(surfWaterNitrateMean), !is.na(startDateTime))  |>
  janitor::clean_names()

# Save for package
usethis::use_data(neon_nitrate, overwrite = TRUE)


# Distribution of nitrate measurements
nitrate_sample_distribution <- neon_nitrate  |>
  count(surf_water_nitrate_mean)  |>
  arrange(desc(n))

# Stratified summary: by month and year (add others as needed)
neon_nitrate <- neon_nitrate  |>
  mutate(month = lubridate::month(start_date_time),
         year = lubridate::year(start_date_time))

strata_summary <- neon_nitrate  |>
  group_by(year, month)  |>
  summarise(
    mean_nitrate = mean(surf_water_nitrate_mean, na.rm = TRUE),
    min_nitrate = min(surf_water_nitrate_mean, na.rm = TRUE),
    max_nitrate = max(surf_water_nitrate_mean, na.rm = TRUE),
    n = n()
  )

# Population estimate (total observation count as surrogate)
pop_est <- neon_nitrate %>%
  summarise(total_obs = n())

